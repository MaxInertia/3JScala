<html>
    <head>
        <title>CCM Options</title>
        <meta charset="utf-8">

        <!-- styles for the first page -->
        <!--<link rel="stylesheet" href="css/optionWindowStyle.css">-->

        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

        <!-- Source of the three links below: https://getbootstrap.com/docs/4.0/getting-started/introduction/ -->

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
        integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    </head>
    <body>
        <h1 style="text-align: center;padding-top: 50px;"> 3D Visualization Tool for Shadow Manifolds </h1>
        <br><br><br>

        <!-- Time Series Input with Options -->
        <div class="row">
            <div class="col-sm-1"></div>

            <!-- Time Series 1 -->
            <div class="col-sm-4 well" style="background-color:">
                <h3 style="text-align:center;">Time Series 1</h3><br>
                <input type="file" id="SM1_timeSeries" style="padding-left: 30px;"/><br>
                <label style="padding-left:32px; padding-right:67px; font-weight: 100; /*font-size: 10px;*/">Tau value:</label>
                <input id="SM1_tau" type="text" placeholder="1 - 99" style="border: inset;"/><br><br>
                <label style="padding-left: 30px; padding-right: 12px; font-weight: 100; font-size: 10px;">Apply...</label><br>
                <label style="padding-left: 30px; padding-right: 12px; font-weight: 100; /*font-size: 10px;*/">First Differentiation?</label>
                <input type="checkbox" id="SM1_firstDiff"/><br>
                <label style="padding-left: 30px; padding-right: 12px; font-weight: 100; /*font-size: 10px;*/">Standardization?</label>
                <input type="checkbox" id="SM1_standardize"/><br>
            </div>
            <div class="col-sm-2"></div>

            <!-- Time Series 2 -->
            <div class="col-sm-4 well" style="background-color:">
                <h3 style="text-align:center;">Time Series 2</h3><br>
                <input type="file" id="SM2_timeSeries" style="padding-left: 30px;"/><br>
                <label style="padding-left:32px; padding-right:67px; font-weight: 100; /*font-size: 10px;*/">Tau value</label>
                <input id="SM2_tau" type="text" placeholder="1 - 99" style="border: inset;"/><br><br>
                <label style="padding-left: 30px; padding-right: 12px; font-weight: 100; font-size: 10px;">Apply...</label><br>
                <label style="padding-left: 30px; padding-right: 12px; font-weight: 100; /*font-size: 10px;*/">First Differentiation?</label>
                <input type="checkbox" id="SM2_firstDiff"/><br>
                <label style="padding-left: 30px; padding-right: 12px; font-weight: 100; /*font-size: 10px;*/">Standardization?</label>
                <input type="checkbox" id="SM2_standardize"/><br>
            </div>

            <div class="col-sm-1"></div>
        </div>

        <!-- Apply options - Loads scene if inputs are valid -->
        <div class="row" style="text-align: center">
            <button style="position: center" onclick="validateForm()">Apply configuration</button>
        </div>
        <br><br><br>

        <!-- Credits footer -->
        <footer class="footer">
            <div class="container">
                <br>
                <span>
                    <p id=welc2 style="text-align:center;">A Tool developed for 3D Visualization & Manipulation of Time Series and their Shadow Manifolds</p>
                    <p class="welbody" style="text-align:center;">Developed by Cephil Lab Usask</p>
                </span>
            </div>
        </footer>

        <script type="text/JavaScript">

            function validateForm() {
                var regexp1 = new RegExp("[^1-99]");
                var tau1 = $("#SM1_tau").val();
                var tau2 = $("#SM2_tau").val();
                var success = true;

                if(regexp1.test(tau1) || tau1 == "") {
                    alert("Tau for Time Series 1 is invalid: Must be an integer between 1 and 99");
                    success = false;
                }

                if(regexp1.test(tau2) || tau2 == "") {
                    alert("Tau for Time Series 2 is invalid: Must be an integer between 1 and 99");
                    success = false;
                }

                if(!success) { return false; }

                // Storing options in local browser storage

                console.log("SM1_tau: " + document.getElementById("SM1_tau").value);
                console.log("SM1_firstDiff: " + $("#SM1_firstDiff").prop('checked'));
                console.log("SM1_standardize: " + $("#SM1_standardize").prop('checked')); //is('checked')
                localStorage.setItem("SM1_tau", tau1);
                localStorage.setItem("SM1_firstDiff", $("#SM1_firstDiff").prop('checked'));
                localStorage.setItem("SM1_standardize",  $("#SM1_standardize").prop('checked'));

                console.log("SM2_tau: " + document.getElementById("SM2_tau").value);
                console.log("SM2_firstDiff: " +  $("#SM2_firstDiff").prop('checked'));
                console.log("SM2_standardize: " +  $("#SM2_standardize").prop('checked'));
                localStorage.setItem("SM2_tau", tau2);
                localStorage.setItem("SM2_firstDiff",  $("#SM2_firstDiff").prop('checked'));
                localStorage.setItem("SM2_standardize",  $("#SM2_standardize").prop('checked'));

                loadTimeSeries();
            }

            var filesLoaded = 0;
            var timeSeries1 = [];
            var timeSeries2 = [];

            function loadTimeSeries() {

                function loadCSV(fileInput) {
                    var csv = document.getElementById(fileInput);
                    console.log("File: "+csv.files[0]);

                    var reader = new FileReader();
                    // Other reader event handlers: onabort, onerror, onloadstart, onloadend, onprogress
                    reader.onload = function(e) {
                        //console.log("reader.result: \n"+ reader.result);

                        // Storing dataset in local browser storage
                        if(filesLoaded==0) {
                            localStorage.setItem("SM1_timeSeries", reader.result);
                        } else {
                            localStorage.setItem("SM2_timeSeries", reader.result);
                            window.location.href='vr'
                        }

                        filesLoaded = filesLoaded + 1;
                    };

                    reader.readAsText(csv.files[0], 'UTF-8');
                }

                localStorage.setItem("showSamples", "false");
                loadCSV("SM1_timeSeries");
                loadCSV("SM2_timeSeries");
            }

        </script>

    </body>
</html>
